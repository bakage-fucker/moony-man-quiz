"use strict";(self.webpackChunkmoony_man_quiz_prod=self.webpackChunkmoony_man_quiz_prod||[]).push([[358],{838:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(81),o=n.n(i),r=n(645),c=n.n(r)()(o());c.push([e.id,".main{width:100%;height:100%;padding-top:2rem;display:flex;flex-direction:column;justify-content:center;align-items:center;color:#f0f8ff}.how-to-play{margin-top:1rem;color:#000}.quiz{width:600px;height:600px;border-color:gray;border-style:groove;border-width:1rem;user-select:none}.quiz .quiz-view{width:calc(600px - 2rem);height:calc(600px - 2rem);background-color:#f5f5f5;display:flex;flex-direction:column;justify-content:center;align-items:center}.question-title-wrapper{width:inherit;height:inherit;background-color:blue;display:flex;justify-content:center;align-items:center}.question-title-wrapper .question-title{user-select:none;font-size:10rem}.question-subtitle{user-select:none;font-size:2rem}.question-wrapper{display:flex;flex-direction:column;justify-content:center;align-items:center}.question-wrapper .img-wrapper{width:360px;height:270px;background-color:#f5f5f5;border-color:#000;border-style:solid;border-width:.1rem;display:flex;justify-content:center;align-items:center}.question-wrapper .img-wrapper img{width:calc(360px - 1rem);height:calc(270px - 1rem);object-fit:contain}.choice-wrapper{display:flex;margin-top:1rem}.choice-button{width:120px;height:160px;margin:2px;padding:6px;display:flex;justify-content:center;align-items:center}.choice-button img{width:108px;height:148px;object-fit:contain}.result-column{width:auto;height:auto;margin:1rem;color:#000;display:flex;flex-direction:column;justify-content:center;align-items:center}.result-column .answer span{margin:0 1px 0 1px}.result-column .points{font-size:2rem}.result-column .points span{margin-left:4px}.result-column button{margin-bottom:10px}",""]);const a=c},358:(e,t,n)=>{n.r(t);var i=n(379),o=n.n(i),r=n(795),c=n.n(r),a=n(569),s=n.n(a),u=n(565),l=n.n(u),m=n(216),h=n.n(m),p=n(589),d=n.n(p),g=n(838),f={};f.styleTagTransform=d(),f.setAttributes=l(),f.insert=s().bind(null,"head"),f.domAPI=c(),f.insertStyleElement=h(),o()(g.Z,f),g.Z&&g.Z.locals&&g.Z.locals,n(487);var E,N=n(294),I=n(935),w=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function c(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}s((i=i.apply(e,t||[])).next())}))};class T{constructor(e,t){this.context=e,this.urlList=t}loadBuffer(e){return w(this,void 0,void 0,(function*(){return fetch(e).then((e=>e.arrayBuffer())).then((e=>this.context.decodeAudioData(e,(()=>{}),(e=>{console.error("DecodeAudioData error",e)}))))}))}load(){return w(this,void 0,void 0,(function*(){return Promise.all(this.urlList.map((e=>this.loadBuffer(e)))).then((e=>{this.bufferList=e}))}))}}!function(e){e.INIT="INIT",e.PLAYING="PLAYING",e.ENDED="ENDED"}(E||(E={}));const S=e=>{switch(e){case"INIT":case"ENDED":return!1;default:return!0}};var x;!function(e){e.PLAY="PLAY",e.STOP="STOP"}(x||(x={}));const y={audioSource:new class{constructor(e){this.loadCompleted=!1,this.audioState=E.INIT,this.context=new AudioContext,this.bufferLoader=new T(this.context,e),this.source=this.context.createBufferSource()}load(e){this.bufferLoader.load().then((()=>{this.loadCompleted=!0,e()}))}play(e,t){this.context.resume().then((()=>{if(this.loadCompleted&&e>=0&&e<this.bufferLoader.bufferList.length){this.source=this.context.createBufferSource(),this.source.buffer=this.bufferLoader.bufferList[e],this.source.connect(this.context.destination);const n=()=>{this.audioState=E.ENDED,t()};this.source.addEventListener("ended",n,{once:!0}),this.audioState=E.PLAYING,t(),this.source.start()}}))}stop(e,t){this.source.stop(),this.audioState=E.ENDED}}(["sound/moony_man_0.wav","sound/moony_man_1.wav","sound/moony_man_2.wav","sound/moony_man_3.wav"]),audioSourceDispatch:()=>{}},b=N.createContext(y),v=({children:e})=>{const[,t]=N.useState(!1),[n,i]=N.useReducer(((e,t)=>{switch(t.type){case"PLAY":return e.audioSource.play(t.idx,(()=>{t.callback()})),e;case"STOP":e.audioSource.stop(t.idx,(()=>{t.callback()}));default:return e}}),y);return N.useEffect((()=>{n.audioSource.load((()=>{t((e=>(console.log("FORCE UPDATE -- AUDIO"),!e)))}))}),[]),N.useEffect((()=>{n.audioSource.loadCompleted&&console.log("LOAD COMPLETED -- AUDIO")}),[n.audioSource.loadCompleted]),N.createElement(b.Provider,{value:{audioSource:n.audioSource,audioSourceDispatch:i}},e)};var A=n(486),q=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function c(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}s((i=i.apply(e,t||[])).next())}))};let j=A.concat({imgKey:"putin",imgUrls:["image/choice/putin/putin0.jpg","image/choice/putin/putin1.jpg","image/choice/putin/putin2.jpg","image/choice/putin/putin3.jpg","image/choice/putin/putin4.jpg","image/choice/putin/putin5.jpg"]},{imgKey:"jinping",imgUrls:["image/choice/jinping/jinping0.jpg","image/choice/jinping/jinping1.jpg","image/choice/jinping/jinping2.jpg","image/choice/jinping/jinping3.jpg","image/choice/jinping/jinping4.jpg","image/choice/jinping/jinping5.jpg"]},{imgKey:"pooh",imgUrls:["image/choice/pooh/pooh0.jpg","image/choice/pooh/pooh1.jpg","image/choice/pooh/pooh2.jpg","image/choice/pooh/pooh3.jpg","image/choice/pooh/pooh4.jpg","image/choice/pooh/pooh5.jpg"]},{imgKey:"question",imgUrls:["image/question/q0.jpg","image/question/q1.jpg","image/question/q2.jpg","image/question/q3.jpg","image/question/q4.jpg","image/question/q5.jpg","image/question/q6.jpg","image/question/q7.jpg"]});var L;!function(e){e.GET="GET"}(L||(L={}));const P={imageSource:new class{constructor(e){this.urlList=[],this.urlMap=new Map,this.choiceImgLengthMap=new Map,this.loadCompleted=!1,this.urlList=e}loadImg(e){return q(this,void 0,void 0,(function*(){return fetch(e).then((e=>e.blob())).then((e=>URL.createObjectURL(e))).then((e=>e))}))}load(e){return q(this,void 0,void 0,(function*(){return Promise.all(this.urlList.map((({imgKey:e,imgUrls:t})=>Promise.all(t.map((e=>this.loadImg(e).then((e=>q(this,void 0,void 0,(function*(){return yield(t=e,new Promise(((e,n)=>{let i=new Image;i.src=t,i.onload=()=>{e(i)},i.onerror=()=>n(new Error("could not load image"))}))),e;var t}))))))).then((t=>{this.urlMap.set(e,t),this.choiceImgLengthMap.set(e,t.length)}))))).then((()=>{this.loadCompleted=!0,e()}))}))}get(e,t){return this.urlMap.get(e)[t]}getRandom(e){let t=this.urlMap.get(e).length,n=A.random(0,t-1);return this.urlMap.get(e)[n]}}(j)},R=N.createContext(P),D=({children:e})=>{const[,t]=N.useState(!1),[n,i]=N.useState(P);return N.useEffect((()=>{n.imageSource.load((()=>{t((e=>(console.log("FORCE UPDATE -- IMAGESOURCE"),!e)))}))}),[]),N.useEffect((()=>{n.imageSource.loadCompleted&&console.log("LOAD COMPLETED -- IMAGESOURCE")}),[n.imageSource.loadCompleted]),N.createElement(R.Provider,{value:{imageSource:n.imageSource}},e)};var C,U,O;!function(e){e.INIT="INIT",e.TITLE="TITLE",e.ANSWERING="ANSWERING",e.ANSWERED="ANSWERED",e.RESULT="RESULT"}(C||(C={})),function(e){e.NEXT="NEXT",e.INIT="INIT"}(U||(U={})),function(e){e.PUTIN="putin",e.JINPING="jinping",e.POOH="pooh"}(O||(O={}));class G{constructor(e,t){this.startAnswerDate=0,this.timeToAnswer=0,this.points=0,this.correctAnswer=t,this.choices=A.shuffle([O.PUTIN,O.JINPING,O.POOH])}setChoiceImgIdx(e){this.choiceImgIdx=this.choices.map((t=>A.random(0,e.get(t)-1)))}initChoices(){this.choices=A.shuffle([O.PUTIN,O.JINPING,O.POOH])}getResult(){return this.userAnswer===this.correctAnswer}timerStart(){this.timeToAnswer=0,this.startAnswerDate=Date.now()}timerEnd(){this.timeToAnswer=Date.now()-this.startAnswerDate,this.startAnswerDate=0}getTimeToAnswer(){return this.timeToAnswer}getPoints(){let e=1e4;return e-=this.timeToAnswer,e+=this.getResult()?1e4:-1e4,e=A.clamp(e,0,2e4),e}}const k=e=>{const[t,n]=N.useState(0),[i,o]=N.useState(A.shuffle([...Array(e.questions.length).keys()])),[r,c]=N.useState(C.INIT),a=()=>{c((e=>{switch(e){case"INIT":return C.TITLE;case"TITLE":return C.ANSWERING;case"ANSWERING":return C.ANSWERED;case"ANSWERED":return t==s.length-1?(m({type:x.PLAY,idx:2,callback:d}),C.RESULT):(m({type:x.PLAY,idx:0,callback:d}),C.TITLE);case"RESULT":return C.INIT;default:return e}}))},[s,u]=N.useState(e.questions),{audioSource:l,audioSourceDispatch:m}=N.useContext(b),{imageSource:h}=N.useContext(R),[,p]=N.useState(!1),d=()=>p((e=>!e));N.useEffect((()=>{}),[]),N.useEffect((()=>{h.loadCompleted&&u((e=>(e.map((e=>{e.setChoiceImgIdx(h.choiceImgLengthMap)})),e)))}),[h.loadCompleted]),N.useEffect((()=>{if(console.log(`AudioState: ${l.audioState}`),"ENDED"===l.audioState)switch(r){case"TITLE":return e=t,u((t=>(t[e].timerStart(),t))),void a();case"ANSWERED":return(e=>{u((t=>(t[e].timerEnd(),t)))})(t),n((e=>++e)),void a();default:return}var e}),[l.audioState]);const g=()=>N.createElement("div",{className:"quiz-view"},N.createElement("h1",{className:"title"},"ムーニーマンクイズ"),N.createElement("button",{className:"button",onClick:()=>{m({type:x.PLAY,idx:0,callback:d}),a()},disabled:!(l.loadCompleted||0===s.length)},"START")),f=e=>N.createElement("div",{className:"quiz-view"},N.createElement("div",{className:"question-title-wrapper"},N.createElement("h1",{className:"question-title"},`第${e.questionNumber+1}問`))),E=e=>N.createElement("button",{className:"choice-button",onClick:()=>{var t,n;a(),m({type:x.PLAY,idx:1,callback:d}),t=e.questionIdx,n=e.choice,u((e=>(e[t].userAnswer=n,e)))},disabled:S(l.audioState)},N.createElement("img",{className:"choice-img",src:h.get(e.choice,e.choiceImgIdx)})),I=e=>{const t=e.question.choices.length,n=[...Array(t).keys()];return N.createElement("div",{className:"quiz-view"},N.createElement("h1",{className:"title"},`第${e.currentQuestionNumber+1}問`),N.createElement("div",{className:"question-wrapper"},N.createElement("div",{className:"img-wrapper"},N.createElement("img",{src:h.get("question",i[e.currentQuestionNumber])})),N.createElement("div",{className:"choice-wrapper"},n.map((t=>N.createElement(E,{idx:t,choice:e.question.choices[t],choiceImgIdx:e.question.choiceImgIdx[t],questionIdx:i[e.currentQuestionNumber],key:t}))))))},w=e=>{const t=e.question.getResult()?"○":"✗";return N.createElement("span",null,t)},T=()=>{let t=A.reduce(i,((e,t)=>e+s[t].getPoints()),0);return N.createElement("div",{className:"quiz-view"},N.createElement("h1",{className:"title"},"RESULT"),N.createElement("div",{className:"result-column"},N.createElement("div",{className:"answer"},i.map((e=>N.createElement(w,{question:s[e],key:e})))),N.createElement("p",{className:"points"},t,N.createElement("span",null,N.createElement("strong",null,"pt")))),N.createElement("div",{className:"result-column"},N.createElement("button",{className:"button",onClick:()=>{a(),n((()=>0)),u((e=>(e.map((e=>{e.initChoices(),e.setChoiceImgIdx(h.choiceImgLengthMap)})),e))),o((t=>A.shuffle([...Array(e.questions.length).keys()]))),m({type:x.STOP,idx:3,callback:d})}},"RETRY"),N.createElement("button",{className:"button",onClick:()=>{let e=encodeURIComponent(`スコアは${t}ptでした！🇺🇦目指せムーニーマン🇺🇦`);window.open(`https://twitter.com/intent/tweet?text=${e}&hashtags=ムーニークイズ`)}},"ツイートする！")))};return N.createElement("div",{className:"quiz"},N.createElement((()=>{switch(r){case"INIT":return console.log("ROUTING : INIT"),N.createElement(g,null);case"TITLE":return console.log("ROUTING : TITLE"),N.createElement(f,{questionNumber:t});case"ANSWERING":return console.log("ROUTING : ANSWERING"),N.createElement(I,{currentQuestionNumber:t,question:s[i[t]]});case"ANSWERED":return console.log("ROUTING : ANSWERD"),N.createElement(I,{currentQuestionNumber:t,question:s[i[t]]});case"RESULT":return console.log("ROUTING : RESULT"),N.createElement(T,null);default:return N.createElement(g,null)}}),null))},M=[new G(0,O.PUTIN),new G(1,O.JINPING),new G(2,O.POOH),new G(3,O.JINPING),new G(4,O.POOH),new G(5,O.JINPING),new G(6,O.PUTIN),new G(7,O.PUTIN)];I.render(N.createElement((()=>N.createElement("section",{className:"main"},N.createElement(v,null,N.createElement(D,null,N.createElement(k,{questions:M}))),N.createElement("p",{className:"how-to-play"},"一番関係があるキャラクターを選ぼう！"),N.createElement("p",{className:"how-to-play"},"音がでるよ！"))),null),document.querySelector("#app"))}}]);